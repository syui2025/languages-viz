<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Languages Spoken by Discipline</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-sankey/0.12.3/d3-sankey.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 1200px;
            width: 100%;
        }
        
        h1 {
            text-align: center;
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 32px;
        }
        
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 30px;
            font-size: 16px;
        }
        
        #sankey {
            width: 100%;
            height: 600px;
        }
        
        .node rect {
            cursor: pointer;
            fill-opacity: 0.9;
            shape-rendering: crispEdges;
        }
        
        .node rect:hover {
            fill-opacity: 1;
        }
        
        .node text {
            pointer-events: none;
            font-size: 14px;
            font-weight: 500;
        }
        
        .link {
            fill: none;
            stroke-opacity: 0.3;
        }
        
        .link:hover {
            stroke-opacity: 0.6;
        }
        
        .tooltip {
            position: absolute;
            padding: 12px 16px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            border-radius: 8px;
            pointer-events: none;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .legend {
            margin-top: 30px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 8px;
            text-align: center;
        }
        
        .legend-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 10px;
        }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            flex-wrap: wrap;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-number {
            font-size: 28px;
            font-weight: 700;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 14px;
            color: #718096;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Languages Spoken by Discipline</h1>
        <p class="subtitle">Flow diagram showing the relationship between team disciplines and languages spoken</p>
        
        <div id="sankey"></div>
        
        <div class="legend">
            <div class="legend-title">Summary Statistics</div>
            <div class="stats">
                <div class="stat">
                    <div class="stat-number">14</div>
                    <div class="stat-label">Total People</div>
                </div>
                <div class="stat">
                    <div class="stat-number">4</div>
                    <div class="stat-label">Disciplines</div>
                </div>
                <div class="stat">
                    <div class="stat-number">7</div>
                    <div class="stat-label">Languages</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="tooltip"></div>
    
    <script>
        // Data from the spreadsheet
        const data = [
            {name: "MP", discipline: "Qual Research", languages: ["French", "Portugese"]},
            {name: "TK", discipline: "Qual Research", languages: []},
            {name: "CP", discipline: "Qual Research", languages: ["Spanish"]},
            {name: "SY", discipline: "Qual Research", languages: ["Japanese"]},
            {name: "CS", discipline: "Qual Research", languages: ["Spanish"]},
            {name: "SB", discipline: "Qual Research", languages: ["Tagalog"]},
            {name: "LG", discipline: "Qual Research", languages: ["Spanish"]},
            {name: "RM", discipline: "Qual Research", languages: ["Russian"]},
            {name: "DH", discipline: "Qual Research", languages: ["Spanish"]},
            {name: "FGJ", discipline: "Qual Research", languages: ["Spanish"]},
            {name: "RR", discipline: "Program", languages: ["Spanish"]},
            {name: "LN", discipline: "Product", languages: ["Spanish", "Portugese"]},
            {name: "FCM", discipline: "Program", languages: ["Spanish", "Portugese"]},
            {name: "JT", discipline: "Data Science", languages: ["Spanish"]}
        ];
        
        // Create links for Sankey
        const links = [];
        const disciplineCounts = {};
        const languageCounts = {};
        
        data.forEach(person => {
            if (person.languages.length === 0) return;
            
            person.languages.forEach(lang => {
                const key = `${person.discipline}-${lang}`;
                const existing = links.find(l => l.source === person.discipline && l.target === lang);
                
                if (existing) {
                    existing.value += 1;
                } else {
                    links.push({
                        source: person.discipline,
                        target: lang,
                        value: 1
                    });
                }
                
                languageCounts[lang] = (languageCounts[lang] || 0) + 1;
            });
            
            disciplineCounts[person.discipline] = (disciplineCounts[person.discipline] || 0) + 1;
        });
        
        // Create nodes
        const disciplines = [...new Set(data.map(d => d.discipline))];
        const languages = [...new Set(data.flatMap(d => d.languages))];
        
        const nodes = [
            ...disciplines.map(d => ({id: d, category: 'discipline'})),
            ...languages.map(l => ({id: l, category: 'language'}))
        ];
        
        // Set up dimensions
        const margin = {top: 20, right: 200, bottom: 20, left: 200};
        const width = 1120 - margin.left - margin.right;
        const height = 600 - margin.top - margin.bottom;
        
        // Create SVG
        const svg = d3.select("#sankey")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);
        
        // Color scales
        const disciplineColors = {
            "Qual Research": "#667eea",
            "Program": "#f093fb",
            "Product": "#4facfe",
            "Data Science": "#43e97b"
        };
        
        const languageColors = {
            "Spanish": "#fa709a",
            "Portugese": "#fee140",
            "French": "#30cfd0",
            "Japanese": "#a8edea",
            "Tagalog": "#fbc2eb",
            "Russian": "#f8b500"
        };
        
        // Create Sankey generator
        const sankey = d3.sankey()
            .nodeId(d => d.id)
            .nodeWidth(20)
            .nodePadding(20)
            .extent([[0, 0], [width, height]]);
        
        // Generate the Sankey layout
        const graph = sankey({
            nodes: nodes.map(d => Object.assign({}, d)),
            links: links.map(d => Object.assign({}, d))
        });
        
        // Tooltip
        const tooltip = d3.select(".tooltip");
        
        // Draw links
        svg.append("g")
            .selectAll("path")
            .data(graph.links)
            .join("path")
            .attr("class", "link")
            .attr("d", d3.sankeyLinkHorizontal())
            .attr("stroke", d => {
                const sourceNode = graph.nodes.find(n => n.id === d.source.id);
                return sourceNode.category === 'discipline' ? 
                    disciplineColors[d.source.id] : languageColors[d.source.id];
            })
            .attr("stroke-width", d => Math.max(1, d.width))
            .on("mouseover", function(event, d) {
                d3.select(this).attr("stroke-opacity", 0.6);
                tooltip
                    .style("opacity", 1)
                    .html(`<strong>${d.source.id} â†’ ${d.target.id}</strong><br/>${d.value} person${d.value > 1 ? 's' : ''}`);
            })
            .on("mousemove", function(event) {
                tooltip
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 10) + "px");
            })
            .on("mouseout", function() {
                d3.select(this).attr("stroke-opacity", 0.3);
                tooltip.style("opacity", 0);
            });
        
        // Draw nodes
        const node = svg.append("g")
            .selectAll("g")
            .data(graph.nodes)
            .join("g")
            .attr("class", "node");
        
        node.append("rect")
            .attr("x", d => d.x0)
            .attr("y", d => d.y0)
            .attr("height", d => d.y1 - d.y0)
            .attr("width", d => d.x1 - d.x0)
            .attr("fill", d => d.category === 'discipline' ? 
                disciplineColors[d.id] : languageColors[d.id])
            .on("mouseover", function(event, d) {
                const count = d.category === 'discipline' ? 
                    disciplineCounts[d.id] : languageCounts[d.id];
                tooltip
                    .style("opacity", 1)
                    .html(`<strong>${d.id}</strong><br/>${count || 0} person${count !== 1 ? 's' : ''}`);
            })
            .on("mousemove", function(event) {
                tooltip
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 10) + "px");
            })
            .on("mouseout", function() {
                tooltip.style("opacity", 0);
            });
        
        // Add labels
        node.append("text")
            .attr("x", d => d.x0 < width / 2 ? d.x1 + 6 : d.x0 - 6)
            .attr("y", d => (d.y1 + d.y0) / 2)
            .attr("dy", "0.35em")
            .attr("text-anchor", d => d.x0 < width / 2 ? "start" : "end")
            .text(d => d.id)
            .attr("fill", "#2d3748");
    </script>
</body>
</html>
